name: check_version_update
description: Check if version file has been updated with the change in the repository

inputs:

  version-file-path:
    description: The path to the file to check for changes from repository base
    required: true
    default: versions.md

  head-ref:
    description: Git reference to compare file
    required: false
    default: ${GITHUB_HEAD_REF}

  base-ref:
    description: Git reference to compare against
    required: false
    default: ${GITHUB_BASE_REF}

runs:
  using: composite
  steps:

    - name: Sync repository
      uses: eProsima/eProsima-CI/external/checkout@feature/versions-update
      with:
        path: ${{ github.workspace }}

    - name: Fetch all branches and tags
      uses: eProsima/eProsima-CI/ubuntu/git_fetch_all@feature/versions-update
      with:
        workspace: ${{ github.workspace }}

    - name: Get diff file of version file
      id: git-diff
      uses: eProsima/eProsima-CI/ubuntu/git_diff@feature/versions-update
      with:
        file-path: ${{ github.workspace }}/${{ inputs.version-file-path }}

    - name: Check if file change
      if: ${{ steps.git-diff.outputs.have-changes == 'false' }}
      shell: bash
      run: |
        echo "Version file ${{ inputs.version-file-path }} has not been updated."
        exit 1
